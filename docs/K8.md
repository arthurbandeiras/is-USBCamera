# Instala√ß√£o do Kubernetes v1.25 no Raspberry Pi com Ubuntu

Este guia apresenta o passo a passo completo para instalar as ferramentas do Kubernetes (`kubeadm`, `kubelet` e `kubectl`) na vers√£o espec√≠fica **1.25** em um Raspberry Pi 4 (ou superior) rodando Ubuntu Server.

> **üö® AVISO DE SEGURAN√áA IMPORTANTE üö®**
>
> Este guia utiliza um m√©todo que **desativa a verifica√ß√£o de seguran√ßa** do reposit√≥rio de pacotes do Kubernetes (`[trusted=yes]`). Isso √© necess√°rio porque a chave de assinatura para a vers√£o **1.25** (que √© uma vers√£o antiga e sem suporte oficial) j√° expirou.
>> 
## Pr√©-requisitos

-   Raspberry Pi 4 ou superior.
-   Ubuntu Server (vers√£o 22.04 LTS ou compat√≠vel) instalado.
-   Acesso ao terminal com privil√©gios `sudo`.
-   Conex√£o com a internet.

## Etapa 1: Prepara√ß√£o do Sistema

Estes comandos preparam o sistema operacional para atender aos pr√©-requisitos do Kubernetes.

1.  **Desabilitar a mem√≥ria swap:**
    ```bash
    sudo swapoff -a
    sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab
    ```

2.  **Carregar m√≥dulos de kernel necess√°rios:**
    ```bash
    cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
    overlay
    br_netfilter
    EOF

    sudo modprobe overlay
    sudo modprobe br_netfilter
    ```

3.  **Configurar par√¢metros do `sysctl` para a rede do Kubernetes:**
    ```bash
    cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
    net.bridge.bridge-nf-call-iptables  = 1
    net.bridge.bridge-nf-call-ip6tables = 1
    net.ipv4.ip_forward                 = 1
    EOF

    sudo sysctl --system
    ```

## Etapa 2: Instala√ß√£o do Container Runtime (containerd)

O Kubernetes precisa de um container runtime para executar os cont√™ineres. Usaremos o `containerd`.

1.  **Instalar o `containerd`:**
    ```bash
    sudo apt-get update
    sudo apt-get install -y containerd
    ```

2.  **Configurar o `containerd`:**
    Crie o arquivo de configura√ß√£o padr√£o e ajuste-o para usar o `systemd` como cgroup driver, que √© o recomendado pelo `kubelet`.
    ```bash
    sudo mkdir -p /etc/containerd
    sudo containerd config default | sudo tee /etc/containerd/config.toml
    sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml
    ```

3.  **Reiniciar e habilitar o servi√ßo do `containerd`:**
    ```bash
    sudo systemctl restart containerd
    sudo systemctl enable containerd
    ```

## Etapa 3: Instala√ß√£o do `kubeadm`, `kubelet` e `kubectl` (v1.25)

Agora, instalaremos as ferramentas do Kubernetes a partir do reposit√≥rio oficial, utilizando a flag que desativa a verifica√ß√£o de seguran√ßa.

1.  **Instalar pacotes de pr√©-requisito para o `apt`:**
    ```bash
    sudo apt-get update
    sudo apt-get install -y apt-transport-https ca-certificates curl
    ```

2.  **Adicionar o reposit√≥rio do Kubernetes v1.25 (com a flag `trusted=yes`):**
    ```bash
    echo "deb [trusted=yes] [https://pkgs.k8s.io/core:/stable:/v1.25/deb/](https://pkgs.k8s.io/core:/stable:/v1.25/deb/) /" | sudo tee /etc/apt/sources.list.d/kubernetes.list
    ```

3.  **Instalar as ferramentas do Kubernetes:**
    ```bash
    sudo apt-get update
    sudo apt-get install -y kubelet kubeadm kubectl
    ```

4.  **Marcar os pacotes para n√£o serem atualizados automaticamente:**
    Isso previne que uma atualiza√ß√£o acidental do sistema (`apt upgrade`) mude a vers√£o do Kubernetes.
    ```bash
    sudo apt-mark hold kubelet kubeadm kubectl
    ```

## Etapa 4: Verifica√ß√£o

Verifique se todos os componentes foram instalados corretamente checando suas vers√µes.

```bash
kubelet --version
# Dever√° retornar algo como: Kubernetes v1.25.x

kubeadm version
# Dever√° retornar a vers√£o do kubeadm
```
